<!DOCTYPE html>
<html>
	<head>
		<title>CubeAdder</title>
		<meta charset="utf-8">
		<meta http-equiv="cache-control" content="max-age=0">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
		<meta http-equiv="pragma" content="no-cache">
		<style>
			body { margin: 0; overflow: hidden;}
			canvas { width: 100%; height: 100% }
		</style>
	</head>

	<body>
		<div id="WebGL-output"></div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.js"></script>
		<script type="text/javascript">
			function init(){

				function setSize (){
						size =  Math.ceil(Math.random() * 3) + (Math.random() * 3) - 1.5; //'-' would also do the same job.
						if (size < 0) {
							console.log("size:" + size);
							return setSize();
						}
						console.log("size:" + size);
						return size;
				}

				var size = 0;

				var width = window.innerWidth;
				var height = window.innerHeight;

				var scene = new THREE.Scene();

				var camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
				scene.add(camera);

				var renderer = new THREE.WebGLRenderer();
				renderer.setClearColor(new THREE.Color(0xEEEEEE));
				renderer.setSize(width, height);
				renderer.shadowMapEnabled = true;

				var axes = new THREE.AxisHelper(20);
				scene.add(axes);

				var planeGeometry = new THREE.PlaneGeometry(60, 20, 1, 1);
				var planeMaterial = new THREE.MeshBasicMaterial({color: 0xcccccc});
				var plane = new THREE.Mesh(planeGeometry, planeMaterial);
				plane.rotation.x = -0.5 * Math.PI;
				plane.position.x = 15;
				plane.position.y = 0;
				plane.position.z = 0;
				plane.reciveShadow = true;
				scene.add(plane);

				camera.position.x=-30;
				camera.position.y=40;
				camera.position.z=30;
				camera.lookAt(scene.position);

				var ambientLight = new THREE.AmbientLight(0x0c0c0c);
				scene.add(ambientLight);

				var spotLight = new THREE.SpotLight(0xffffff);
				spotLight.position.x = -40;
				spotLight.position.x = 60;
				spotLight.position.x = -10;
				spotLight.castShadow = true;
				//scene.add(spotLight);

				function addCuboid() {
					var cuboidSizeX = setSize();
					var cuboidSizeY = setSize();
					var cuboidSizeZ = setSize();

					var cuboidGeometry = new THREE.BoxGeometry(cuboidSizeX, cuboidSizeY, cuboidSizeZ);
					var cuboidMaterial = new THREE.MeshBasicMaterial({color: Math.random() * 0xffffff});
					var cuboid = new THREE.Mesh(cuboidGeometry, cuboidMaterial);
					cuboid.castShadow = true;

					cuboid.id = "cube-" + scene.children.length;
					cuboid.position.x = 0; // -30 + Math.round(Math.random() * planeGeometry.width);
					cuboid.position.y = 0; // Math.round(Math.random() * 5);
					cuboid.position.z = 0; // -20 + Math.round(Math.random() * planeGeometry.height);
					scene.add(cuboid);
					console.log("after adding cuboid");
					this.numberOfObjects = scene.children.length;
				}
				addCuboid();
				document.getElementById("WebGL-output").appendChild(renderer.domElement);
				renderer.render(scene, camera);
				console.log("after render");
			};
			window.onload = init;

		</script>

	</body>
</html>
