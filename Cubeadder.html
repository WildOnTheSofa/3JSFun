<!DOCTYPE html>
<html>
	<head>
		<title>CubeAdder</title>
		<meta charset="utf-8">
		<meta http-equiv="cache-control" content="max-age=0">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
		<meta http-equiv="pragma" content="no-cache">
		<style>
			body { margin: 0; overflow: hidden;}
			canvas { width: 100%; height: 100% }
		</style>
	</head>

	<body>
		<div id="WebGL-output"></div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.js"> </script>
		<script type="text/javascript">

			function init(){
				var controls = new function(){
					this.lightIntensity = 20;
					this.cuboidsAdded = 1;
					this.cuboidsRemoved = 1;
					this.rotationSpeedX = 0.2; // 20
					this.rotationSpeedY = 0.2;
					this.rotationSpeedZ = 0.2;

					this.addCuboids = function(){
						console.log("Adding " + Math.floor(controls.cuboidsAdded) + " cuboids.");
						for(i = controls.cuboidsAdded; i >= 0; i--){
							addCuboid();
							console.log("i:" + i);
						}

					}
				}
				var gui = new dat.GUI();
				gui.add(controls, 'lightIntensity', 0, 100, 1);
				gui.add(controls, 'cuboidsAdded', 0, 100, 10);
				gui.add(controls, 'cuboidsRemoved', 0, 50, 1);
				gui.add(controls, 'rotationSpeedX', 0, 0.5);
				gui.add(controls, 'rotationSpeedY', 0, 0.5);
				gui.add(controls, 'rotationSpeedZ', 0, 0.5);

				gui.add(controls, 'addCuboids');

				function setCuboidSize (){
					return Math.ceil(Math.random() * 6);
				}

				function setSign (){
					number = Math.round(Math.random());
					if(number == 0){
						number = -1;
					}
					return number;
				}
				var number = 0;

				var i = 0;

				var sign = setSign();

				var size = 0;

				var width = window.innerWidth;
				var height = window.innerHeight;

				var scene = new THREE.Scene();

				var camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);

				var renderer = new THREE.WebGLRenderer();
				renderer.setClearColor(new THREE.Color(0xEEEEEE));
				renderer.setSize(width, height);
				renderer.shadowMapEnabled = true;

				var axes = new THREE.AxisHelper(20);
				scene.add(axes);

				var planeWidth = 40;
				var planeHeight = 40;
				var planeGeometry = new THREE.PlaneGeometry(planeWidth, planeHeight);
				var planeMaterial = new THREE.MeshLambertMaterial({color: 0xcccccc});
				var plane = new THREE.Mesh(planeGeometry, planeMaterial);
				plane.rotation.x = -0.5 * Math.PI;
				plane.position.x = 0;
				plane.position.y = 0;
				plane.position.z = 0;
				plane.reciveShadow = true;
				scene.add(plane);

				camera.position.x = 0;
				camera.position.y = 10;
				camera.position.z = 35;
				camera.lookAt(scene.position);
				scene.add(camera);

				var ambientLight = new THREE.AmbientLight(0x0c0c0c);
				scene.add(ambientLight);

				var spotLight = new THREE.SpotLight(0xffffff);
				spotLight.position.x = 0;
				spotLight.position.y = 10;
				spotLight.position.z = 30;
				spotLight.castShadow = true;
				scene.add(spotLight);


				function addCuboid() {
					var cuboidSizeX = setCuboidSize();
					var cuboidSizeY = setCuboidSize();
					var cuboidSizeZ = setCuboidSize();

					var cuboidGeometry = new THREE.BoxGeometry(cuboidSizeX, cuboidSizeY, cuboidSizeZ);
					var cuboidMaterial = new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff});
					var cuboid = new THREE.Mesh(cuboidGeometry, cuboidMaterial);
					cuboid.castShadow = true;

					cuboid.id = "cube-" + scene.children.length;
					cuboid.position.x = (Math.random() * sign) * planeWidth / 2 - (cuboidSizeX * sign);
					sign = setSign();
					cuboid.position.y = 0;
					cuboid.position.z = (Math.random() * sign) * planeHeight / 2 - (cuboidSizeZ * sign);
					sign = setSign();
					console.log("X: " + cuboid.position.x);
					console.log("Z: " + cuboid.position.z);
					scene.add(cuboid);
					this.numberOfObjects = scene.children.length;
				}
				addCuboid();
				document.getElementById("WebGL-output").appendChild(renderer.domElement);
				renderScene();

				function renderScene(){
					spotLight.intensity = controls.lightIntensity/10;
					requestAnimationFrame(renderScene);
					renderer.render(scene, camera);
				}
			}
			window.onload = init;

		</script>

	</body>
</html>
